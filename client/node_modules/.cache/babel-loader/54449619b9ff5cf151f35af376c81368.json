{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zowie/Desktop/chat_box/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/zowie/Desktop/chat_box/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/zowie/Desktop/chat_box/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{useHistory}from\"react-router-dom\";import Chat from\"./Chat\";import\"./app.scss\";var Join=function Join(){var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),contacts=_useState4[0],setContacts=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),target=_useState6[0],setTarget=_useState6[1];var _useState7=useState(\"*\"),_useState8=_slicedToArray(_useState7,2),room=_useState8[0],setRoom=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),chatRecords=_useState10[0],setChatRecords=_useState10[1];var user_name=localStorage.getItem(\"name\");var id=localStorage.getItem(\"id\");var authtoken=localStorage.getItem(\"auth\");var headers={user_name:user_name,id:id,authtoken:authtoken};var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var chatRes,listRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(user_name&&id&&authtoken)){_context.next=12;break;}setName(user_name);_context.next=4;return axios.get(\"http://localhost:5000/dashboard\",{headers:headers});case 4:chatRes=_context.sent;setChatRecords(chatRes.data.user_chats);_context.next=8;return axios.get(\"http://localhost:5000/userlists\",{headers:headers});case 8:listRes=_context.sent;setContacts(listRes.data);_context.next=13;break;case 12:history.push(\"/\");case 13:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();var saveToRecentContactList=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(\"http://localhost:5000/dashboard\",{user_name:name,partner:target},{headers:headers});case 2:res=_context2.sent;console.log(res.message);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function saveToRecentContactList(){return _ref2.apply(this,arguments);};}();useEffect(function(){fetchData();// eslint-disable-next-line\n},[target]);useEffect(function(){var roomName=[name,target].sort().join(\"*\");setRoom(roomName);saveToRecentContactList();// eslint-disable-next-line\nfetchData();// eslint-disable-next-line\n},[target]);return/*#__PURE__*/React.createElement(\"div\",{className:\"joinContainer\"},/*#__PURE__*/React.createElement(\"div\",{className:\"recentChats\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Recent Chats\"),chatRecords!==null&&chatRecords.length>0&&/*#__PURE__*/React.createElement(\"div\",{className:\"recentList\"},chatRecords.map(function(chat){return/*#__PURE__*/React.createElement(\"p\",{onClick:function onClick(){setTarget(chat.partner);}},chat.partner);}))),/*#__PURE__*/React.createElement(\"div\",null,room!==\"*\"&&/*#__PURE__*/React.createElement(Chat,{name:name,room:room,partner:target})),/*#__PURE__*/React.createElement(\"div\",{className:\"allContacts\"},\" \",/*#__PURE__*/React.createElement(\"div\",{className:\"contact\",onClick:function onClick(){localStorage.clear();history.push(\"/\");}},\"Logout\"),/*#__PURE__*/React.createElement(\"h1\",null,\"All contacts\"),contacts!==null&&/*#__PURE__*/React.createElement(\"div\",null,contacts.map(function(contact){return/*#__PURE__*/React.createElement(\"div\",{className:\"contact\",onClick:function onClick(){setTarget(contact);}},contact);}))));};export default Join;","map":{"version":3,"sources":["/Users/zowie/Desktop/chat_box/client/src/components/Join.js"],"names":["React","useState","useEffect","axios","useHistory","Chat","Join","history","name","setName","contacts","setContacts","target","setTarget","room","setRoom","chatRecords","setChatRecords","user_name","localStorage","getItem","id","authtoken","headers","fetchData","get","chatRes","data","user_chats","listRes","push","saveToRecentContactList","post","partner","res","console","log","message","roomName","sort","join","length","map","chat","clear","contact"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useHistory } from \"react-router-dom\";\nimport Chat from \"./Chat\";\nimport \"./app.scss\";\n\nconst Join = () => {\n  const history = useHistory();\n  const [name, setName] = useState(null);\n  const [contacts, setContacts] = useState(null);\n  const [target, setTarget] = useState(null);\n  const [room, setRoom] = useState(\"*\");\n  const [chatRecords, setChatRecords] = useState(null);\n\n  const user_name = localStorage.getItem(\"name\");\n  const id = localStorage.getItem(\"id\");\n  const authtoken = localStorage.getItem(\"auth\");\n  const headers = {\n    user_name: user_name,\n    id: id,\n    authtoken: authtoken,\n  };\n\n  const fetchData = async () => {\n    if (user_name && id && authtoken) {\n      setName(user_name);\n\n      const chatRes = await axios.get(\"http://localhost:5000/dashboard\", {\n        headers: headers,\n      });\n      setChatRecords(chatRes.data.user_chats);\n\n      const listRes = await axios.get(\"http://localhost:5000/userlists\", {\n        headers: headers,\n      });\n\n      setContacts(listRes.data);\n    } else {\n      history.push(\"/\");\n    }\n  };\n\n  const saveToRecentContactList = async () => {\n    const res = await axios.post(\n      \"http://localhost:5000/dashboard\",\n      { user_name: name, partner: target },\n      { headers: headers }\n    );\n    console.log(res.message);\n  };\n\n  useEffect(() => {\n    fetchData();\n    // eslint-disable-next-line\n  }, [target]);\n\n  useEffect(() => {\n    const roomName = [name, target].sort().join(\"*\");\n    setRoom(roomName);\n\n    saveToRecentContactList();\n    // eslint-disable-next-line\n    fetchData();\n    // eslint-disable-next-line\n  }, [target]);\n\n  return (\n    <div className=\"joinContainer\">\n      <div className=\"recentChats\">\n        <h1>Recent Chats</h1>\n\n        {chatRecords !== null && chatRecords.length > 0 && (\n          <div className=\"recentList\">\n            {chatRecords.map((chat) => (\n              <p\n                onClick={() => {\n                  setTarget(chat.partner);\n                }}\n              >\n                {chat.partner}\n              </p>\n            ))}\n          </div>\n        )}\n      </div>\n      <div>\n        {room !== \"*\" && <Chat name={name} room={room} partner={target} />}\n      </div>\n\n      <div className=\"allContacts\">\n        {\" \"}\n        <div\n          className=\"contact\"\n          onClick={() => {\n            localStorage.clear();\n            history.push(\"/\");\n          }}\n        >\n          Logout\n        </div>\n        <h1>All contacts</h1>\n        {contacts !== null && (\n          <div>\n            {contacts.map((contact) => (\n              <div\n                className=\"contact\"\n                onClick={() => {\n                  setTarget(contact);\n                }}\n              >\n                {contact}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Join;\n"]},"metadata":{},"sourceType":"module"}